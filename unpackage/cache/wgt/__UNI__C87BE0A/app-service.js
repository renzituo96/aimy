if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const s=this.constructor;return this.then((t=>s.resolve(e()).then((()=>t))),(t=>s.resolve(e()).then((()=>{throw t}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function s(e,s,...t){uni.__log__?uni.__log__(e,s,...t):console[e].apply(console,[...t,s])}__definePage("pages/index/index",((e,s)=>{const t=e.__vccOpts||e;for(const[a,i]of s)t[a]=i;return t})({data:()=>({form:{username:"",email:"",password:""},isLoading:!1,message:"",isSuccess:!1,supabaseConfig:{url:"https://bomcaovuvfnoystxrrqf.supabase.co",key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJvbWNhb3Z1dmZub3lzdHhycnFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0MjY2MDksImV4cCI6MjA3NjAwMjYwOX0.-L13h5RR9fFZV4H9Bj3bGf9e3S5N_isWa8kuzqjlhHs"}}),onLoad(){},methods:{validateForm(){if(!this.form.username.trim())return this.showMessage("请输入用户名",!1),!1;if(!this.form.email.trim())return this.showMessage("请输入邮箱",!1),!1;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.form.email)?this.form.password?!(this.form.password.length<6)||(this.showMessage("密码长度不能少于6位",!1),!1):(this.showMessage("请输入密码",!1),!1):(this.showMessage("请输入有效的邮箱地址",!1),!1)},showMessage(e,s){this.message=e,this.isSuccess=s,setTimeout((()=>{this.message=""}),3e3)},testConnection(){try{this.isLoading=!0,this.showMessage("正在测试连接...",!1),s("log","at pages/index/index.vue:99","测试Supabase连接 - URL:",this.supabaseConfig.url),s("log","at pages/index/index.vue:100","测试Supabase连接 - KEY:",this.supabaseConfig.key.substring(0,10)+"..."),uni.request({url:this.supabaseConfig.url+"/rest/v1/users",method:"GET",header:{Authorization:"Bearer "+this.supabaseConfig.key,apiKey:this.supabaseConfig.key,Accept:"application/json"},params:{limit:0},success:e=>{s("log","at pages/index/index.vue:115","连接测试响应:",JSON.stringify(e)),e.statusCode>=200&&e.statusCode<300?this.showMessage("连接成功！Supabase API 可访问。",!0):401===e.statusCode?this.showMessage("连接失败: 未授权 (401)，请检查API密钥是否正确",!1):404===e.statusCode?this.showMessage("连接失败: 资源未找到 (404)，请检查URL和表名是否正确",!1):this.showMessage("连接失败！状态码: "+e.statusCode,!1)},fail:e=>{s("error","at pages/index/index.vue:129","连接测试错误:",JSON.stringify(e)),this.showMessage("连接错误: "+(e.errMsg||"网络连接失败"),!1)},complete:()=>{this.isLoading=!1}})}catch(e){s("error","at pages/index/index.vue:137","连接测试异常:",e),this.showMessage("程序错误: "+(e.message||"未知错误"),!1),this.isLoading=!1}},handleRegister(){try{if(!this.validateForm())return;this.isLoading=!0,this.showMessage("正在提交注册信息...",!1),s("log","at pages/index/index.vue:154","准备发送注册请求..."),s("log","at pages/index/index.vue:155","发送注册请求，URL:",this.supabaseConfig.url+"/rest/v1/users"),uni.request({url:this.supabaseConfig.url+"/rest/v1/users",method:"POST",data:{username:this.form.username,email:this.form.email,password:this.form.password},header:{"Content-Type":"application/json",apiKey:this.supabaseConfig.key,Authorization:"Bearer "+this.supabaseConfig.key,Accept:"application/json"},success:e=>{if(s("log","at pages/index/index.vue:173","注册响应:",JSON.stringify(e)),e.statusCode>=200&&e.statusCode<300)this.showMessage("注册成功！用户信息已保存",!0),this.form={username:"",email:"",password:""};else if(409===e.statusCode)try{let s=e.data||{};"string"==typeof s&&(s=JSON.parse(s||"{}")),s.message?s.message.includes("username")?this.showMessage("用户名已存在",!1):s.message.includes("email")?this.showMessage("邮箱已被注册",!1):this.showMessage("该用户信息已存在",!1):this.showMessage("用户名或邮箱已存在",!1)}catch(t){this.showMessage("用户名或邮箱已存在",!1)}else 401===e.statusCode?(this.showMessage("未授权访问 (401)，请先测试连接检查API密钥",!1),setTimeout((()=>{this.testConnection()}),1e3)):400===e.statusCode?this.showMessage("请求参数错误，请检查输入",!1):this.showMessage("注册失败，状态码: "+e.statusCode,!1)},fail:e=>{s("error","at pages/index/index.vue:218","注册请求失败:",JSON.stringify(e)),e.errMsg&&e.errMsg.includes("request:fail")?this.showMessage("网络请求失败，请检查网络连接",!1):this.showMessage(e.errMsg||"注册请求失败",!1)},complete:()=>{this.isLoading=!1}})}catch(e){s("error","at pages/index/index.vue:230","注册过程异常:",e),this.showMessage("程序错误: "+(e.message||"未知错误"),!1),this.isLoading=!1}}}},[["render",function(s,t,a,i,o,r){return e.openBlock(),e.createElementBlock("view",{class:"content"},[e.createElementVNode("image",{class:"logo",src:"/static/logo.png"}),e.createElementVNode("view",{class:"register-form"},[e.createElementVNode("view",{class:"form-title"},"用户注册"),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("text",{class:"label"},"用户名"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":t[0]||(t[0]=e=>o.form.username=e),placeholder:"请输入用户名"},null,512),[[e.vModelText,o.form.username]])]),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("text",{class:"label"},"邮箱"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":t[1]||(t[1]=e=>o.form.email=e),type:"email",placeholder:"请输入邮箱"},null,512),[[e.vModelText,o.form.email]])]),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("text",{class:"label"},"密码"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":t[2]||(t[2]=e=>o.form.password=e),type:"password",placeholder:"请输入密码",password:"true"},null,512),[[e.vModelText,o.form.password]])]),e.createElementVNode("button",{class:"register-btn",onClick:t[3]||(t[3]=(...e)=>r.handleRegister&&r.handleRegister(...e)),disabled:o.isLoading},e.toDisplayString(o.isLoading?"注册中...":"注册"),9,["disabled"]),e.createElementVNode("button",{class:"test-btn",onClick:t[4]||(t[4]=(...e)=>r.testConnection&&r.testConnection(...e)),disabled:o.isLoading},"测试连接",8,["disabled"]),o.message?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["message",{success:o.isSuccess,error:!o.isSuccess}])},e.toDisplayString(o.message),3)):e.createCommentVNode("",!0)])])}]]));const t={onLaunch:function(){s("log","at App.vue:4","App Launch")},onShow:function(){s("log","at App.vue:7","App Show")},onHide:function(){s("log","at App.vue:10","App Hide")}};const{app:a,Vuex:i,Pinia:o}={app:e.createVueApp(t)};uni.Vuex=i,uni.Pinia=o,a.provide("__globalStyles",__uniConfig.styles),a._component.mpType="app",a._component.render=()=>{},a.mount("#app")}(Vue);
